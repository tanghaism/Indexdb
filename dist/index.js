var __async=(t,e,n)=>new Promise(((i,s)=>{var o=t=>{try{c(n.next(t))}catch(e){s(e)}},r=t=>{try{c(n.throw(t))}catch(e){s(e)}},c=t=>t.done?i(t.value):Promise.resolve(t.value).then(o,r);c((n=n.apply(t,e)).next())}));!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).IndexDB=e()}(this,(function(){"use strict";const t=class{constructor(e,n){this.options=Object.assign({},t.defaultOptions,n),this.name=e,this.version=this.options.version,this.db=void 0,this.initComplete=!1,this.versionChanged=null,this.initPromise=this.init();for(const t of this.options.store){const{storeName:e}=t;this[`$${e}`]={add:(t,n)=>this.add(e,t,n),put:(t,n)=>this.put(e,t,n),getAll:(t,n)=>this.getAll(e,t,n),get:(t,n)=>this.get(e,t,n),getAllKeys:(t,n)=>this.getAllKeys(e,t,n),count:t=>this.count(e,t),delete:t=>this.delete(e,t),deleteIndex:t=>this.deleteIndex(e,t),elasticSearch:(t,n)=>this.elasticSearch(e,t,n),index:t=>this.index(e,t),clear:()=>this.clear(e)}}}init(){return __async(this,null,(function*(){return new Promise(((t,e)=>{if(this.initComplete)return t(this.db);const n=window.indexedDB.open(this.name,this.version);n.onerror=t=>{e(t)},n.onsuccess=()=>__async(this,null,(function*(){this.db=n.result,this.initComplete=!0,this.db.onversionchange=()=>{window.location.reload()},this.versionChanged&&this.options.upgradeCallBack&&(yield this.options.upgradeCallBack(this,this.versionChanged)),t(this.db)})),n.onupgradeneeded=t=>__async(this,null,(function*(){this.versionChanged=t,yield this._upgrade(t,n)}))}))}))}_upgrade(t,e){return __async(this,null,(function*(){this.db=t.target.result;for(const t of this.options.store)yield this.createStore(t,e);return this.db}))}createStore(e,n){return __async(this,null,(function*(){const{storeName:i,options:s,indexOptions:o}=e;let r;return this.db.objectStoreNames.contains(i)?n.transaction.objectStore(i):(r=this.db.createObjectStore(i,Object.assign({},t.defaultStoreOptions,s)),console.log(r),o&&o.forEach((t=>{r.createIndex(t.name,t.key,{unique:t.unique,multiEntry:!!t.multiEntry})})),r)}))}add(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction([t],"readwrite").objectStore(t).add(e,n);o.onsuccess=function(t){i(t)},o.onerror=function(t){s(t)}}))}))}delete(t,e){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((n,i)=>{const s=this.db.transaction([t],"readwrite").objectStore(t).delete(e);s.onsuccess=function(t){n(t)},s.onerror=function(t){i(t)}}))}))}deleteIndex(t,e){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),this.db.transaction([t],"readwrite").objectStore(t).deleteIndex(e),"delete success"}))}clear(t){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((e,n)=>{const i=this.db.transaction([t],"readwrite").objectStore(t).clear();i.onsuccess=t=>{e(t)},i.onerror=t=>{n(t)}}))}))}put(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction([t],"readwrite").objectStore(t).put(e,n);o.onsuccess=function(){i(e)},o.onerror=function(t){s(t)}}))}))}get(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction([t],"readonly").objectStore(t);let r;if(n){const t=o.index(n);r=t.get(e)}else r=o.get(e);r.onerror=function(t){s(t)},r.onsuccess=function(){r.result?i(r.result):i(null)}}))}))}getAllKeys(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction([t],"readonly").objectStore(t).getAllKeys(e,n);o.onsuccess=function(){i(o.result)},o.onerror=function(t){s(t)}}))}))}getAll(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction(t).objectStore(t),r=null!=n?o.getAll(e,n):o.getAll(e);r.onsuccess=function(){i(r.result)},r.onerror=function(t){s(t)}}))}))}elasticSearch(t,e,n){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((i,s)=>{const o=this.db.transaction(t).objectStore(t),r=[],c=o.openCursor();c.onsuccess=t=>{const s=t.target.result;s?(Array.isArray(n)?n.some((t=>this._compareType(s.value,e,t)))&&r.push(s.value):this._compareType(s.value,e,n)&&r.push(s.value),s.continue()):i(r)},c.onerror=t=>{s(t)}}))}))}_compareType(t,e,n){const i=n?t[n]:t;let s=!1;switch(typeof i){case"boolean":s="boolean"==typeof e&&i===e;break;case"number":case"bigint":s="number"==typeof e&&i===e;break;case"string":s="string"==typeof e&&i.indexOf(e)>-1||e instanceof RegExp&&e.test(i);break;default:Array.isArray(i)&&(s=e instanceof RegExp?i.some((t=>e.test(t))):i.includes(e))}return s}index(t,e){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),this.db.transaction(t).objectStore(t).index(e)}))}count(t,e){return __async(this,null,(function*(){return this.initComplete||(yield this.initPromise),new Promise(((n,i)=>{const s=this.db.transaction(t).objectStore(t).count(e);s.onsuccess=function(){n(s.result)},s.onerror=function(t){i(t)}}))}))}};let e=t;return e.defaultOptions={version:1,store:[]},e.defaultStoreOptions={autoIncrement:!0},e}));
